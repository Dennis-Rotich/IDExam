<!DOCTYPE html>
<html>
<head>
    <title>Teacher Dashboard</title>
    <style>
        .student-card { 
            border: 1px solid #333; margin: 10px; padding: 10px; 
            width: 300px; float: left; background: #f9f9f9; 
        }
        .student-code { 
            width: 100%; height: 150px; background: #222; 
            color: #0f0; border: none; font-family: monospace; 
        }
    </style>
</head>
<body>
    <h2>Exam Proctor Dashboard</h2>
    <div id="grid"></div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const grid = document.getElementById('grid');

        // 1. Join as Teacher
        socket.on('connect', () => {
            socket.emit('join_exam', 'teacher');
        });

        // 2. Handle New Student Connection
        socket.on('student_joined', (id) => {
            createStudentCard(id);
        });

        // 3. Handle Live Code Updates
        socket.on('update_student_view', (data) => {
            let card = document.getElementById(`card-${data.studentId}`);
            
            // If we missed the join event, create the card now
            if (!card) {
                createStudentCard(data.studentId);
            }

            // Update the specific textarea for this student
            const textarea = document.getElementById(`code-${data.studentId}`);
            textarea.value = data.code;
            
            // Visual flair: Flash border to show activity
            textarea.style.borderColor = "red";
            setTimeout(() => textarea.style.borderColor = "transparent", 200);
        });

        // 4. Handle Student Disconnect
        socket.on('student_left', (id) => {
            const card = document.getElementById(`card-${id}`);
            if (card) {
                card.style.opacity = "0.5";
                card.innerHTML += "<br><strong>(OFFLINE)</strong>";
            }
        });

        // Helper to generate HTML dynamically
        function createStudentCard(id) {
            if (document.getElementById(`card-${id}`)) return; // No duplicates

            const div = document.createElement('div');
            div.className = 'student-card';
            div.id = `card-${id}`;
            div.innerHTML = `
                <h4>Student: ${id.substr(0,4)}...</h4>
                <textarea id="code-${id}" class="student-code" readonly></textarea>
            `;
            grid.appendChild(div);
        }
    </script>
</body>
</html>